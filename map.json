{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1200,
  "height": 700,
  "projection": {
    "type": "naturalEarth1",
    "scale": 200,
    "translate": [600, 350]
  },
  "layer": [
    {
      "data": {
        "values": [
          {"type": "LineString", "coordinates": [[-180, -90], [-180, 90]]},
          {"type": "LineString", "coordinates": [[-150, -90], [-150, 90]]},
          {"type": "LineString", "coordinates": [[-120, -90], [-120, 90]]},
          {"type": "LineString", "coordinates": [[-90, -90], [-90, 90]]},
          {"type": "LineString", "coordinates": [[-60, -90], [-60, 90]]},
          {"type": "LineString", "coordinates": [[-30, -90], [-30, 90]]},
          {"type": "LineString", "coordinates": [[0, -90], [0, 90]]},
          {"type": "LineString", "coordinates": [[30, -90], [30, 90]]},
          {"type": "LineString", "coordinates": [[60, -90], [60, 90]]},
          {"type": "LineString", "coordinates": [[90, -90], [90, 90]]},
          {"type": "LineString", "coordinates": [[120, -90], [120, 90]]},
          {"type": "LineString", "coordinates": [[150, -90], [150, 90]]},
          {"type": "LineString", "coordinates": [[180, -90], [180, 90]]},
          {"type": "LineString", "coordinates": [[-180, -60], [-150, -60], [-120, -60], [-90, -60], [-60, -60], [-30, -60], [0, -60], [30, -60], [60, -60], [90, -60], [120, -60], [150, -60], [180, -60]]},
          {"type": "LineString", "coordinates": [[-180, -30], [-150, -30], [-120, -30], [-90, -30], [-60, -30], [-30, -30], [0, -30], [30, -30], [60, -30], [90, -30], [120, -30], [150, -30], [180, -30]]},
          {"type": "LineString", "coordinates": [[-180, 0], [-150, 0], [-120, 0], [-90, 0], [-60, 0], [-30, 0], [0, 0], [30, 0], [60, 0], [90, 0], [120, 0], [150, 0], [180, 0]]},
          {"type": "LineString", "coordinates": [[-180, 30], [-150, 30], [-120, 30], [-90, 30], [-60, 30], [-30, 30], [0, 30], [30, 30], [60, 30], [90, 30], [120, 30], [150, 30], [180, 30]]},
          {"type": "LineString", "coordinates": [[-180, 60], [-150, 60], [-120, 60], [-90, 60], [-60, 60], [-30, 60], [0, 60], [30, 60], [60, 60], [90, 60], [120, 60], [150, 60], [180, 60]]}
        ]
      },
      "mark": {
        "type": "geoshape",
        "fill": "transparent",
        "stroke": "lightgray",
        "strokeWidth": 0.5,
        "strokeOpacity": 0.6
      }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/vega/vega-datasets/main/data/world-110m.json",
        "format": {"type": "topojson", "feature": "countries"}
      },
      "transform": [
        {
          "lookup": "id",
          "from": {
            "data": {"url": "real_player_counts.csv?v=2"},
            "key": "id",
            "fields": ["players", "country_name"]
          }
        },
        {
          "lookup": "id",
          "from": {
            "data": {"url": "population_data.csv?v=2"},
            "key": "id",
            "fields": ["population"]
          }
        },
        {
          "calculate": "datum.players / datum.population",
          "as": "players_per_million"
        }
      ],
      "mark": {
        "type": "geoshape",
        "cursor": "pointer"
      },
      "encoding": {
        "color": {
          "field": "players_per_million",
          "type": "quantitative",
          "scale": {
            "scheme": "blues",
            "type": "linear",
            "domain": [0, 200]
          },
          "legend": {"title": "Players per Million Population"}
        },
        "stroke": {"value": "white"},
        "strokeWidth": {"value": 0.5},
        "tooltip": [
          {"field": "country_name", "type": "nominal", "title": "Country"},
          {"field": "players", "type": "quantitative", "title": "Total Players"},
          {"field": "players_per_million", "type": "quantitative", "title": "Players per Million", "format": ".1f"}
        ]
      }
    }
  ]
}